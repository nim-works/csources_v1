/* Generated by Nim Compiler v0.1.0-dev.20827 */
#define NIM_INTBITS 64

#include "nimbase.h"
#include <string.h>
#undef LANGUAGE_C
#undef MIPSEB
#undef MIPSEL
#undef PPC
#undef R3000
#undef R4000
#undef i386
#undef linux
#undef mips
#undef near
#undef far
#undef powerpc
#undef unix
#define nimfr_(x, y)
#define nimln_(x, y)
typedef struct NimStrPayload NimStrPayload;
typedef struct NimStringV2 NimStringV2;
typedef struct tyObject_PathIter__tllF14xUpDWpqG9ci5sg9bMg tyObject_PathIter__tllF14xUpDWpqG9ci5sg9bMg;
typedef struct tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ;
struct NimStrPayload {
NI cap;
NIM_CHAR data[SEQ_DECL_SIZE];
};
struct NimStringV2 {
NI len;
NimStrPayload* p;
};
struct tyObject_PathIter__tllF14xUpDWpqG9ci5sg9bMg {
NI i;
NI prev;
NIM_BOOL notFirst;
};
struct tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ {
NI Field0;
NI Field1;
};
static N_INLINE(void, nimZeroMem)(void* p, NI size);
static N_INLINE(void, nimSetMem__systemZmemory_7)(void* a, int v, NI size);
N_LIB_PRIVATE N_NIMCALL(NIM_BOOL, hasNext__pureZpathnorm_6)(tyObject_PathIter__tllF14xUpDWpqG9ci5sg9bMg it, NimStringV2 x);
N_LIB_PRIVATE N_NIMCALL(tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ, next__pureZpathnorm_10)(tyObject_PathIter__tllF14xUpDWpqG9ci5sg9bMg* it, NimStringV2 x);
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void);
N_LIB_PRIVATE N_NIMCALL(NIM_BOOL, isSlash__pureZpathnorm_70)(NimStringV2 x, tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ bounds);
static N_INLINE(void, nimAddCharV1)(NimStringV2* s, NIM_CHAR c);
N_LIB_PRIVATE N_NIMCALL(void, prepareAdd)(NimStringV2* s, NI addlen);
N_LIB_PRIVATE N_NIMCALL(NIM_BOOL, isDotDot__pureZpathnorm_66)(NimStringV2 x, tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ bounds);
N_LIB_PRIVATE N_NIMCALL(void, setLengthStrV2)(NimStringV2* s, NI newLen);
N_LIB_PRIVATE N_NIMCALL(NimStringV2, substr__system_7617)(NimStringV2 s, NI first, NI last);
static N_INLINE(void, appendString)(NimStringV2* dest, NimStringV2 src);
static N_INLINE(void, copyMem__system_1708)(void* dest, void* source, NI size);
static N_INLINE(void, nimCopyMem)(void* dest, void* source, NI size);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___system_3226)(NimStringV2* dest);
N_LIB_PRIVATE N_NIMCALL(NIM_BOOL, isDot__pureZpathnorm_62)(NimStringV2 x, tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ bounds);
N_LIB_PRIVATE N_NIMCALL(void, eqsink___system_3232)(NimStringV2* dest, NimStringV2 src);
N_LIB_PRIVATE N_NIMCALL(NimStringV2, rawNewString)(NI space);
N_NIMCALL(NimStringV2, rawNewString)(NI cap);
N_LIB_PRIVATE N_NIMCALL(void, addNormalizePath__pureZpathnorm_78)(NimStringV2 x, NimStringV2* result, NI* state, NIM_CHAR dirSep);
static const struct {
  NI cap; NIM_CHAR data[1+1];
} TM__DfU0iuayCGwHDN1Exp9cbKg_2 = { 1 | NIM_STRLIT_FLAG, "." };
static const NimStringV2 TM__DfU0iuayCGwHDN1Exp9cbKg_3 = {1, (NimStrPayload*)&TM__DfU0iuayCGwHDN1Exp9cbKg_2};
extern NIM_BOOL nimInErrorMode__system_4174;
static N_INLINE(void, nimSetMem__systemZmemory_7)(void* a, int v, NI size) {
	void* T1_;
	T1_ = (void*)0;
	T1_ = memset(a, v, ((size_t) (size)));
	(void)(T1_);
}
static N_INLINE(void, nimZeroMem)(void* p, NI size) {
	nimSetMem__systemZmemory_7(p, ((int) 0), size);
}
N_LIB_PRIVATE N_NIMCALL(NIM_BOOL, hasNext__pureZpathnorm_6)(tyObject_PathIter__tllF14xUpDWpqG9ci5sg9bMg it, NimStringV2 x) {
	NIM_BOOL result;
	result = (NIM_BOOL)0;
	result = (it.i < x.len);
	return result;
}
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void) {
	NIM_BOOL* result;
	result = (NIM_BOOL*)0;
	result = (&nimInErrorMode__system_4174);
	return result;
}
N_LIB_PRIVATE N_NIMCALL(tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ, next__pureZpathnorm_10)(tyObject_PathIter__tllF14xUpDWpqG9ci5sg9bMg* it, NimStringV2 x) {
	tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ result;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	nimZeroMem((void*)(&result), sizeof(tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ));
	(*it).prev = (*it).i;
	{
		NIM_BOOL colontmp_;
		colontmp_ = (NIM_BOOL)0;
		{
			colontmp_ = !((*it).notFirst);
			{
				if (!!(colontmp_)) goto LA5_;
				goto LA2;
			}
			LA5_: ;
			colontmp_ = (((NU8)(x.p->data[(*it).i])) == ((NU8)(92)) || ((NU8)(x.p->data[(*it).i])) == ((NU8)(47)));
		} LA2: ;
		{
			NIM_BOOL colontmp__2;
			NIM_BOOL colontmp__3;
			NIM_BOOL colontmp__4;
			if (!colontmp_) goto LA9_;
			colontmp__2 = (NIM_BOOL)0;
			colontmp__3 = (NIM_BOOL)0;
			(*it).i += ((NI) 1);
			colontmp__4 = (NIM_BOOL)0;
			{
				{
					{
						colontmp__3 = hasNext__pureZpathnorm_6((*it), x);
						if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
						{
							if (!!(colontmp__3)) goto LA16_;
							goto LA13;
						}
						LA16_: ;
						colontmp__3 = ((NU8)(x.p->data[(*it).i]) == (NU8)(92));
					} LA13: ;
					colontmp__2 = colontmp__3;
					{
						if (!!(colontmp__2)) goto LA20_;
						goto LA12;
					}
					LA20_: ;
					colontmp__2 = ((NI)((*it).i + ((NI) 1)) < x.len);
				} LA12: ;
				colontmp__4 = colontmp__2;
				{
					if (!!(colontmp__4)) goto LA24_;
					goto LA11;
				}
				LA24_: ;
				colontmp__4 = !(((NU8)(x.p->data[(NI)((*it).i + ((NI) 1))]) == (NU8)(92)));
			} LA11: ;
			{
				if (!colontmp__4) goto LA28_;
				(*it).i += ((NI) 1);
			}
			LA28_: ;
			goto LA1;
		}
		LA9_: ;
		{
			while (1) {
				NIM_BOOL colontmp__5;
				colontmp__5 = (NIM_BOOL)0;
				{
					colontmp__5 = ((*it).i < x.len);
					{
						if (!!(colontmp__5)) goto LA35_;
						goto LA32;
					}
					LA35_: ;
					colontmp__5 = !((((NU8)(x.p->data[(*it).i])) == ((NU8)(92)) || ((NU8)(x.p->data[(*it).i])) == ((NU8)(47))));
				} LA32: ;
				{
					if (!!(colontmp__5)) goto LA39_;
					goto LA31;
				}
				LA39_: ;
				(*it).i += ((NI) 1);
			} LA31: ;
		}
	} LA1: ;
	{
		{
			NI colontmp__6;
			NI colontmp__7;
			if (!((*it).prev < (*it).i)) goto LA44_;
			colontmp__6 = (*it).prev;
			colontmp__7 = (NI)((*it).i - ((NI) 1));
			result.Field0 = colontmp__6;
			result.Field1 = colontmp__7;
			goto LA41;
		}
		LA44_: ;
		{
			NIM_BOOL T48_;
			T48_ = (NIM_BOOL)0;
			T48_ = hasNext__pureZpathnorm_6((*it), x);
			if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
			if (!T48_) goto LA49_;
			result = next__pureZpathnorm_10(it, x);
			if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
			goto LA41;
		}
		LA49_: ;
	} LA41: ;
	{
		while (1) {
			NIM_BOOL colontmp__8;
			colontmp__8 = (NIM_BOOL)0;
			{
				colontmp__8 = ((*it).i < x.len);
				{
					if (!!(colontmp__8)) goto LA56_;
					goto LA53;
				}
				LA56_: ;
				colontmp__8 = (((NU8)(x.p->data[(*it).i])) == ((NU8)(92)) || ((NU8)(x.p->data[(*it).i])) == ((NU8)(47)));
			} LA53: ;
			{
				if (!!(colontmp__8)) goto LA60_;
				goto LA52;
			}
			LA60_: ;
			(*it).i += ((NI) 1);
		} LA52: ;
	}
	(*it).notFirst = NIM_TRUE;
	}BeforeRet_: ;
	return result;
}
N_LIB_PRIVATE N_NIMCALL(NIM_BOOL, isSlash__pureZpathnorm_70)(NimStringV2 x, tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ bounds) {
	NIM_BOOL result;
	NIM_BOOL colontmp_;
	result = (NIM_BOOL)0;
	colontmp_ = (NIM_BOOL)0;
	{
		colontmp_ = (bounds.Field1 == bounds.Field0);
		{
			if (!!(colontmp_)) goto LA4_;
			goto LA1;
		}
		LA4_: ;
		colontmp_ = (((NU8)(x.p->data[bounds.Field0])) == ((NU8)(92)) || ((NU8)(x.p->data[bounds.Field0])) == ((NU8)(47)));
	} LA1: ;
	result = colontmp_;
	return result;
}
static N_INLINE(void, nimAddCharV1)(NimStringV2* s, NIM_CHAR c) {
	prepareAdd(s, ((NI) 1));
	(*(*s).p).data[(*s).len] = c;
	(*(*s).p).data[(NI)((*s).len + ((NI) 1))] = 0;
	(*s).len += ((NI) 1);
}
N_LIB_PRIVATE N_NIMCALL(NIM_BOOL, isDotDot__pureZpathnorm_66)(NimStringV2 x, tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ bounds) {
	NIM_BOOL result;
	NIM_BOOL colontmp_;
	NIM_BOOL colontmp__2;
	result = (NIM_BOOL)0;
	colontmp_ = (NIM_BOOL)0;
	colontmp__2 = (NIM_BOOL)0;
	{
		{
			colontmp__2 = (bounds.Field1 == (NI)(bounds.Field0 + ((NI) 1)));
			{
				if (!!(colontmp__2)) goto LA5_;
				goto LA2;
			}
			LA5_: ;
			colontmp__2 = ((NU8)(x.p->data[bounds.Field0]) == (NU8)(46));
		} LA2: ;
		colontmp_ = colontmp__2;
		{
			if (!!(colontmp_)) goto LA9_;
			goto LA1;
		}
		LA9_: ;
		colontmp_ = ((NU8)(x.p->data[(NI)(bounds.Field0 + ((NI) 1))]) == (NU8)(46));
	} LA1: ;
	result = colontmp_;
	return result;
}
static N_INLINE(void, nimCopyMem)(void* dest, void* source, NI size) {
	void* T1_;
	T1_ = (void*)0;
	T1_ = memcpy(dest, source, ((size_t) (size)));
	(void)(T1_);
}
static N_INLINE(void, copyMem__system_1708)(void* dest, void* source, NI size) {
	nimCopyMem(dest, source, size);
}
static N_INLINE(void, appendString)(NimStringV2* dest, NimStringV2 src) {
	{
		if (!(((NI) 0) < src.len)) goto LA3_;
		copyMem__system_1708(((void*) ((&(*(*dest).p).data[(*dest).len]))), ((void*) ((&(*src.p).data[((NI) 0)]))), ((NI) ((NI)(src.len + ((NI) 1)))));
		(*dest).len += src.len;
	}
	LA3_: ;
}
N_LIB_PRIVATE N_NIMCALL(NIM_BOOL, isDot__pureZpathnorm_62)(NimStringV2 x, tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ bounds) {
	NIM_BOOL result;
	NIM_BOOL colontmp_;
	result = (NIM_BOOL)0;
	colontmp_ = (NIM_BOOL)0;
	{
		colontmp_ = (bounds.Field1 == bounds.Field0);
		{
			if (!!(colontmp_)) goto LA4_;
			goto LA1;
		}
		LA4_: ;
		colontmp_ = ((NU8)(x.p->data[bounds.Field0]) == (NU8)(46));
	} LA1: ;
	result = colontmp_;
	return result;
}
N_LIB_PRIVATE N_NIMCALL(void, addNormalizePath__pureZpathnorm_78)(NimStringV2 x, NimStringV2* result, NI* state, NIM_CHAR dirSep) {
	tyObject_PathIter__tllF14xUpDWpqG9ci5sg9bMg it;
NIM_BOOL oldNimErrFin85_;
	NIM_BOOL colontmp__10;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	nimZeroMem((void*)(&it), sizeof(tyObject_PathIter__tllF14xUpDWpqG9ci5sg9bMg));
	it.notFirst = (((NI) 0) < (NI)((NI64)((*state)) >> (NU64)(((NI) 1))));
	{
		if (!it.notFirst) goto LA3_;
		{
			while (1) {
				NIM_BOOL colontmp_;
				colontmp_ = (NIM_BOOL)0;
				{
					colontmp_ = (it.i < x.len);
					{
						if (!!(colontmp_)) goto LA10_;
						goto LA7;
					}
					LA10_: ;
					colontmp_ = (((NU8)(x.p->data[it.i])) == ((NU8)(92)) || ((NU8)(x.p->data[it.i])) == ((NU8)(47)));
				} LA7: ;
				{
					if (!!(colontmp_)) goto LA14_;
					goto LA6;
				}
				LA14_: ;
				it.i += ((NI) 1);
			} LA6: ;
		}
	}
	LA3_: ;
	{
		while (1) {
			tyTuple__1v9bKyksXWMsm0vNwmZ4EuQ b;
			{
				NIM_BOOL T20_;
				T20_ = (NIM_BOOL)0;
				T20_ = hasNext__pureZpathnorm_6(it, x);
				if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
				if (!!(T20_)) goto LA21_;
				goto LA17;
			}
			LA21_: ;
			b = next__pureZpathnorm_10((&it), x);
			if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
			{
				NIM_BOOL colontmp__2;
				colontmp__2 = (NIM_BOOL)0;
				{
					colontmp__2 = ((NI)((NI64)((*state)) >> (NU64)(((NI) 1))) == ((NI) 0));
					{
						if (!!(colontmp__2)) goto LA27_;
						goto LA24;
					}
					LA27_: ;
					colontmp__2 = isSlash__pureZpathnorm_70(x, b);
					if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
				} LA24: ;
				{
					NIM_BOOL colontmp__3;
					if (!colontmp__2) goto LA31_;
					colontmp__3 = (NIM_BOOL)0;
					{
						colontmp__3 = ((*result).len == ((NI) 0));
						{
							if (!colontmp__3) goto LA36_;
							goto LA33;
						}
						LA36_: ;
						colontmp__3 = !((((NU8)((*result).p->data[(NI)((*result).len - ((NI) 1))])) == ((NU8)(92)) || ((NU8)((*result).p->data[(NI)((*result).len - ((NI) 1))])) == ((NU8)(47))));
					} LA33: ;
					{
						if (!colontmp__3) goto LA40_;
						nimAddCharV1((&(*result)), dirSep);
					}
					LA40_: ;
					(*state) = (NI)((*state) | ((NI) 1));
					goto LA23;
				}
				LA31_: ;
				{
					NIM_BOOL T44_;
					T44_ = (NIM_BOOL)0;
					T44_ = isDotDot__pureZpathnorm_66(x, b);
					if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
					if (!T44_) goto LA45_;
					{
						NimStringV2 colontmp__5;
						NIM_BOOL colontmp__6;
						{
							NI d;
							if (!(((NI) 1) <= (NI)((NI64)((*state)) >> (NU64)(((NI) 1))))) goto LA50_;
							d = (*result).len;
							{
								while (1) {
									NIM_BOOL colontmp__4;
									colontmp__4 = (NIM_BOOL)0;
									{
										colontmp__4 = ((NI)((*state) & ((NI) 1)) < (NI)(d - ((NI) 1)));
										{
											if (!!(colontmp__4)) goto LA57_;
											goto LA54;
										}
										LA57_: ;
										colontmp__4 = !((((NU8)((*result).p->data[(NI)(d - ((NI) 1))])) == ((NU8)(92)) || ((NU8)((*result).p->data[(NI)(d - ((NI) 1))])) == ((NU8)(47))));
									} LA54: ;
									{
										if (!!(colontmp__4)) goto LA61_;
										goto LA53;
									}
									LA61_: ;
									d -= ((NI) 1);
								} LA53: ;
							}
							{
								if (!(((NI) 0) < d)) goto LA65_;
								setLengthStrV2((&(*result)), ((NI) ((NI)(d - ((NI) 1)))));
								(*state) -= ((NI) 2);
							}
							LA65_: ;
							goto LA47;
						}
						LA50_: ;
						colontmp__5.len = 0; colontmp__5.p = NIM_NIL;
						colontmp__6 = (NIM_BOOL)0;
						{
							colontmp__6 = (((NI) 0) < (*result).len);
							{
								if (!!(colontmp__6)) goto LA70_;
								goto LA67;
							}
							LA70_: ;
							colontmp__6 = !((((NU8)((*result).p->data[(NI)((*result).len - ((NI) 1))])) == ((NU8)(92)) || ((NU8)((*result).p->data[(NI)((*result).len - ((NI) 1))])) == ((NU8)(47))));
						} LA67: ;
						{
							if (!colontmp__6) goto LA74_;
							nimAddCharV1((&(*result)), dirSep);
						}
						LA74_: ;
						colontmp__5 = substr__system_7617(x, b.Field0, b.Field1);
						if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
						prepareAdd((&(*result)), colontmp__5.len + 0);
appendString((&(*result)), colontmp__5);
						eqdestroy___system_3226((&colontmp__5));
					} LA47: ;
					goto LA23;
				}
				LA45_: ;
				{
					NIM_BOOL T78_;
					T78_ = (NIM_BOOL)0;
					T78_ = isDot__pureZpathnorm_62(x, b);
					if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
					if (!T78_) goto LA79_;
					goto LA23;
				}
				LA79_: ;
				{
					NimStringV2 colontmp__7;
					NIM_BOOL colontmp__8;
					NimStringV2 colontmp__9;
					if (!(b.Field0 <= b.Field1)) goto LA83_;
					colontmp__7.len = 0; colontmp__7.p = NIM_NIL;
					colontmp__8 = (NIM_BOOL)0;
					{
						colontmp__8 = (((NI) 0) < (*result).len);
						{
							if (!!(colontmp__8)) goto LA89_;
							goto LA86;
						}
						LA89_: ;
						colontmp__8 = !((((NU8)((*result).p->data[(NI)((*result).len - ((NI) 1))])) == ((NU8)(92)) || ((NU8)((*result).p->data[(NI)((*result).len - ((NI) 1))])) == ((NU8)(47))));
					} LA86: ;
					{
						if (!colontmp__8) goto LA93_;
						nimAddCharV1((&(*result)), dirSep);
					}
					LA93_: ;
					colontmp__9 = substr__system_7617(x, b.Field0, b.Field1);
					if (NIM_UNLIKELY(*nimErr_)) goto LA85_;
					colontmp__7 = colontmp__9;
					prepareAdd((&(*result)), colontmp__7.len + 0);
appendString((&(*result)), colontmp__7);
					(*state) += ((NI) 2);
					eqdestroy___system_3226((&colontmp__7));
					goto LA23;
					{
						LA85_:;
					}
					{
						oldNimErrFin85_ = *nimErr_; *nimErr_ = NIM_FALSE;
						eqdestroy___system_3226((&colontmp__7));
						*nimErr_ = oldNimErrFin85_;
					}
					if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
				}
				LA83_: ;
			} LA23: ;
		} LA17: ;
	}
	colontmp__10 = (NIM_BOOL)0;
	{
		colontmp__10 = ((*result).len == 0);
		{
			if (!!(colontmp__10)) goto LA100_;
			goto LA97;
		}
		LA100_: ;
		colontmp__10 = !((x.len == 0));
	} LA97: ;
	{
		NimStringV2* colontmp__11;
		if (!colontmp__10) goto LA104_;
		colontmp__11 = result;
		eqsink___system_3232(colontmp__11, TM__DfU0iuayCGwHDN1Exp9cbKg_3);
	}
	LA104_: ;
	}BeforeRet_: ;
}
N_LIB_PRIVATE N_NIMCALL(NimStringV2, normalizePath__pureZpathnorm_134)(NimStringV2 path, NIM_CHAR dirSep) {
	NimStringV2 result;
	NI state;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result.len = 0; result.p = NIM_NIL;
	result = rawNewString(((NI) (path.len)));
	state = ((NI) 0);
	addNormalizePath__pureZpathnorm_78(path, (&result), (&state), dirSep);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
	return result;
}
