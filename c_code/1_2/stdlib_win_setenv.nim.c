/* Generated by Nim Compiler v0.1.0-dev.20827 */
#define NIM_INTBITS 64

#include "nimbase.h"
#include <string.h>
#include <stdlib.h>
#include <errno.h>
#undef LANGUAGE_C
#undef MIPSEB
#undef MIPSEL
#undef PPC
#undef R3000
#undef R4000
#undef i386
#undef linux
#undef mips
#undef near
#undef far
#undef powerpc
#undef unix
#define nimfr_(x, y)
#define nimln_(x, y)
typedef struct NimStrPayload NimStrPayload;
typedef struct NimStringV2 NimStringV2;
typedef struct tySequence__9aKpvUh0ca6Bp9cKAwrowqUg tySequence__9aKpvUh0ca6Bp9cKAwrowqUg;
typedef struct tySequence__9aKpvUh0ca6Bp9cKAwrowqUg_Content tySequence__9aKpvUh0ca6Bp9cKAwrowqUg_Content;
struct NimStrPayload {
NI cap;
NIM_CHAR data[SEQ_DECL_SIZE];
};
struct NimStringV2 {
NI len;
NimStrPayload* p;
};
struct tySequence__9aKpvUh0ca6Bp9cKAwrowqUg {
  NI len; tySequence__9aKpvUh0ca6Bp9cKAwrowqUg_Content* p;
};
typedef NI16 tyUncheckedArray__5WAtReG1juofV6itYKi25g[1];
typedef N_STDCALL_PTR(NI32, tyProc__3pVglHKolpBa6UoJifpHkA) (NCSTRING lpName, NCSTRING lpValue);


#ifndef tySequence__9aKpvUh0ca6Bp9cKAwrowqUg_Content_PP
#define tySequence__9aKpvUh0ca6Bp9cKAwrowqUg_Content_PP
struct tySequence__9aKpvUh0ca6Bp9cKAwrowqUg_Content { NI cap; NI16 data[SEQ_DECL_SIZE];};
#endif

      

#ifndef tySequence__9aKpvUh0ca6Bp9cKAwrowqUg_Content_PP
#define tySequence__9aKpvUh0ca6Bp9cKAwrowqUg_Content_PP
struct tySequence__9aKpvUh0ca6Bp9cKAwrowqUg_Content { NI cap; NI16 data[SEQ_DECL_SIZE];};
#endif

      static N_INLINE(NIM_BOOL, eqeq___system_7597)(NCSTRING x, NCSTRING y);
static N_INLINE(NCSTRING, nimToCStringConv)(NimStringV2 s);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___system_3226)(NimStringV2* dest);
static N_INLINE(void, appendString)(NimStringV2* dest, NimStringV2 src);
static N_INLINE(void, copyMem__system_1708)(void* dest, void* source, NI size);
static N_INLINE(void, nimCopyMem)(void* dest, void* source, NI size);
N_LIB_PRIVATE N_NIMCALL(NimStringV2, rawNewString)(NI space);
N_LIB_PRIVATE N_NIMCALL(tySequence__9aKpvUh0ca6Bp9cKAwrowqUg, newSeq__stdZprivateZwin95setenv_32)(NI len);
N_LIB_PRIVATE N_NIMCALL(void, newSeq__systemZwidestrs_11)(tySequence__9aKpvUh0ca6Bp9cKAwrowqUg* s, NI len);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___systemZwidestrs_119)(tySequence__9aKpvUh0ca6Bp9cKAwrowqUg* dest);
N_LIB_PRIVATE N_NIMCALL(void*, nimLoadLibrary)(NimStringV2 path);
N_LIB_PRIVATE N_NIMCALL(void, nimLoadLibraryError)(NimStringV2 path);
N_LIB_PRIVATE N_NIMCALL(void*, nimGetProcAddr)(void* lib, NCSTRING name);
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void);
static const struct {
  NI cap; NIM_CHAR data[1+1];
} TM__UOYsq9cbb0VE8vr3Xt181HA_2 = { 1 | NIM_STRLIT_FLAG, "=" };
static const NimStringV2 TM__UOYsq9cbb0VE8vr3Xt181HA_3 = {1, (NimStrPayload*)&TM__UOYsq9cbb0VE8vr3Xt181HA_2};
static const struct {
  NI cap; NIM_CHAR data[3+1];
} TM__UOYsq9cbb0VE8vr3Xt181HA_4 = { 3 | NIM_STRLIT_FLAG, "=  " };
static const NimStringV2 TM__UOYsq9cbb0VE8vr3Xt181HA_5 = {3, (NimStrPayload*)&TM__UOYsq9cbb0VE8vr3Xt181HA_4};
static const struct {
  NI cap; NIM_CHAR data[8+1];
} TM__UOYsq9cbb0VE8vr3Xt181HA_8 = { 8 | NIM_STRLIT_FLAG, "kernel32" };
static const NimStringV2 TM__UOYsq9cbb0VE8vr3Xt181HA_9 = {8, (NimStrPayload*)&TM__UOYsq9cbb0VE8vr3Xt181HA_8};
static const struct {
  NI cap; NIM_CHAR data[8+1];
} TM__UOYsq9cbb0VE8vr3Xt181HA_10 = { 8 | NIM_STRLIT_FLAG, "kernel32" };
static const NimStringV2 TM__UOYsq9cbb0VE8vr3Xt181HA_11 = {8, (NimStrPayload*)&TM__UOYsq9cbb0VE8vr3Xt181HA_10};
extern wchar_t** _wenviron;
static void* TM__UOYsq9cbb0VE8vr3Xt181HA_6;
tyProc__3pVglHKolpBa6UoJifpHkA Dl_1375731714_;
extern NIM_BOOL nimInErrorMode__system_4174;
static N_INLINE(NIM_BOOL, eqeq___system_7597)(NCSTRING x, NCSTRING y) {
	NIM_BOOL result;
	result = (NIM_BOOL)0;
	{
		NIM_BOOL colontmp_;
		int T15_;
		{
			if (!(((void*) (x)) == ((void*) (y)))) goto LA4_;
			result = NIM_TRUE;
			goto LA1;
		}
		LA4_: ;
		colontmp_ = (NIM_BOOL)0;
		{
			colontmp_ = (x == 0);
			{
				if (!colontmp_) goto LA9_;
				goto LA6;
			}
			LA9_: ;
			colontmp_ = (y == 0);
		} LA6: ;
		{
			if (!colontmp_) goto LA13_;
			result = NIM_FALSE;
			goto LA1;
		}
		LA13_: ;
		T15_ = (int)0;
		T15_ = strcmp(x, y);
		result = (T15_ == ((NI32) 0));
	} LA1: ;
	return result;
}
static N_INLINE(NCSTRING, nimToCStringConv)(NimStringV2 s) {
	NCSTRING result;
	result = (NCSTRING)0;
	{
		{
			if (!(s.len == ((NI) 0))) goto LA4_;
			result = "";
			goto LA1;
		}
		LA4_: ;
		result = ((NCSTRING) ((*s.p).data));
	} LA1: ;
	return result;
}
static N_INLINE(void, nimCopyMem)(void* dest, void* source, NI size) {
	void* T1_;
	T1_ = (void*)0;
	T1_ = memcpy(dest, source, ((size_t) (size)));
	(void)(T1_);
}
static N_INLINE(void, copyMem__system_1708)(void* dest, void* source, NI size) {
	nimCopyMem(dest, source, size);
}
static N_INLINE(void, appendString)(NimStringV2* dest, NimStringV2 src) {
	{
		if (!(((NI) 0) < src.len)) goto LA3_;
		copyMem__system_1708(((void*) ((&(*(*dest).p).data[(*dest).len]))), ((void*) ((&(*src.p).data[((NI) 0)]))), ((NI) ((NI)(src.len + ((NI) 1)))));
		(*dest).len += src.len;
	}
	LA3_: ;
}
N_LIB_PRIVATE N_NIMCALL(tySequence__9aKpvUh0ca6Bp9cKAwrowqUg, newSeq__stdZprivateZwin95setenv_32)(NI len) {
	tySequence__9aKpvUh0ca6Bp9cKAwrowqUg result;
	result.len = 0; result.p = NIM_NIL;
	newSeq__systemZwidestrs_11((&result), len);
	return result;
}
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void) {
	NIM_BOOL* result;
	result = (NIM_BOOL*)0;
	result = (&nimInErrorMode__system_4174);
	return result;
}
N_LIB_PRIVATE N_NIMCALL(int, setEnvImpl__stdZprivateZwin95setenv_17)(NimStringV2 name, NimStringV2 value, int overwrite) {
	int result;
	NimStringV2 envstring;
	NIM_BOOL colontmp_;
	NimStringV2 T25_;
	NCSTRING s;
NIM_BOOL oldNimErrFin35_;
NIM_BOOL oldNimErrFin1_;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result = (int)0;
	envstring.len = 0; envstring.p = NIM_NIL;
	colontmp_ = (NIM_BOOL)0;
	{
		NCSTRING T7_;
		NIM_BOOL T8_;
		colontmp_ = (overwrite == ((NI32) 0));
		{
			if (!!(colontmp_)) goto LA5_;
			goto LA2;
		}
		LA5_: ;
		T7_ = (NCSTRING)0;
		T7_ = getenv(nimToCStringConv(name));
		T8_ = (NIM_BOOL)0;
		T8_ = eqeq___system_7597(T7_, ((NCSTRING) NIM_NIL));
		colontmp_ = !(T8_);
	} LA2: ;
	{
		if (!colontmp_) goto LA11_;
		result = ((int) 0);
		eqdestroy___system_3226((&envstring));
		goto BeforeRet_;
	}
	LA11_: ;
	{
		NimStringV2 envstring_2;
		NimStringV2 T18_;
		int e;
		if (!!((value.len == 0))) goto LA15_;
		envstring_2.len = 0; envstring_2.p = NIM_NIL;
		T18_.len = 0; T18_.p = NIM_NIL;
		T18_ = rawNewString(name.len + value.len + 1);
appendString((&T18_), name);
appendString((&T18_), TM__UOYsq9cbb0VE8vr3Xt181HA_3);
appendString((&T18_), value);
		envstring_2 = T18_;
		e = _putenv(nimToCStringConv(envstring_2));
		{
			if (!!((e == ((NI32) 0)))) goto LA21_;
			errno = ((int) 22);
			result = ((int) -1);
			eqdestroy___system_3226((&envstring_2));
			eqdestroy___system_3226((&envstring));
			goto BeforeRet_;
		}
		LA21_: ;
		result = ((int) 0);
		eqdestroy___system_3226((&envstring_2));
		eqdestroy___system_3226((&envstring));
		goto BeforeRet_;
		{
			LA17_:;
		}
		{
			eqdestroy___system_3226((&envstring_2));
		}
		if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	}
	LA15_: ;
	T25_.len = 0; T25_.p = NIM_NIL;
	T25_ = rawNewString(name.len + 3);
appendString((&T25_), name);
appendString((&T25_), TM__UOYsq9cbb0VE8vr3Xt181HA_5);
	envstring = T25_;
	{
		int T28_;
		T28_ = (int)0;
		T28_ = _putenv(nimToCStringConv(envstring));
		if (!!((T28_ == ((NI32) 0)))) goto LA29_;
		errno = ((int) 22);
		result = ((int) -1);
		eqdestroy___system_3226((&envstring));
		goto BeforeRet_;
	}
	LA29_: ;
	s = getenv(nimToCStringConv(name));
	s[((NI) 0)] = 0;
	s = getenv(nimToCStringConv(name));
	s[((NI) 1)] = 61;
	{
		tySequence__9aKpvUh0ca6Bp9cKAwrowqUg buf;
		NI requiredSize;
		size_t T36_;
		wchar_t* buf2;
		NI16* ptrToEnv;
		wchar_t* T42_;
		wchar_t* T43_;
		if (!!((_wenviron == ((wchar_t**) NIM_NIL)))) goto LA33_;
		buf.len = 0; buf.p = NIM_NIL;
		T36_ = (size_t)0;
		T36_ = mbstowcs(((wchar_t*) NIM_NIL), nimToCStringConv(name), ((size_t) 0));
		requiredSize = ((NI) (T36_));
		buf = newSeq__stdZprivateZwin95setenv_32(((NI) ((NI)(requiredSize + ((NI) 1)))));
		if (NIM_UNLIKELY(*nimErr_)) goto LA35_;
		buf2 = ((wchar_t*) ((&buf.p->data[((NI) 0)])));
		{
			size_t T39_;
			T39_ = (size_t)0;
			T39_ = mbstowcs(buf2, nimToCStringConv(name), ((size_t) ((NI)(requiredSize + ((NI) 1)))));
			if (!(T39_ == ((size_t) -1))) goto LA40_;
			errno = ((int) 22);
			result = ((int) -1);
			eqdestroy___systemZwidestrs_119((&buf));
			eqdestroy___system_3226((&envstring));
			goto BeforeRet_;
		}
		LA40_: ;
		T42_ = (wchar_t*)0;
		T42_ = _wgetenv(buf2);
		ptrToEnv = ((NI16*) (T42_));
		ptrToEnv[((NI) 0)] = ((NI16) 0);
		T43_ = (wchar_t*)0;
		T43_ = _wgetenv(buf2);
		ptrToEnv = ((NI16*) (T43_));
		ptrToEnv[((NI) 1)] = ((NI16) 61);
		{
			LA35_:;
		}
		{
			oldNimErrFin35_ = *nimErr_; *nimErr_ = NIM_FALSE;
			eqdestroy___systemZwidestrs_119((&buf));
			*nimErr_ = oldNimErrFin35_;
		}
		if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	}
	LA33_: ;
	{
		NI32 T48_;
		T48_ = (NI32)0;
		T48_ = Dl_1375731714_(nimToCStringConv(name), nimToCStringConv(value));
		if (!(T48_ == ((NI32) 0))) goto LA49_;
		errno = ((int) 22);
		result = ((int) -1);
		eqdestroy___system_3226((&envstring));
		goto BeforeRet_;
	}
	LA49_: ;
	result = ((int) 0);
	eqdestroy___system_3226((&envstring));
	goto BeforeRet_;
	{
		LA1_:;
	}
	{
		oldNimErrFin1_ = *nimErr_; *nimErr_ = NIM_FALSE;
		eqdestroy___system_3226((&envstring));
		*nimErr_ = oldNimErrFin1_;
	}
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
	return result;
}
N_LIB_PRIVATE N_NIMCALL(void, stdlib_win_setenvDatInit000)(void) {
if (!((TM__UOYsq9cbb0VE8vr3Xt181HA_6 = nimLoadLibrary(TM__UOYsq9cbb0VE8vr3Xt181HA_9))
)) nimLoadLibraryError(TM__UOYsq9cbb0VE8vr3Xt181HA_11);
	Dl_1375731714_ = (tyProc__3pVglHKolpBa6UoJifpHkA) nimGetProcAddr(TM__UOYsq9cbb0VE8vr3Xt181HA_6, "SetEnvironmentVariableA");
}

