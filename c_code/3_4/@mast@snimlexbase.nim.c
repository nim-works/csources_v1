/* Generated by Nim Compiler v0.1.0-dev.20827 */
#define NIM_INTBITS 64
#define NIM_EmulateOverflowChecks

#include "nimbase.h"
#include <string.h>
#undef LANGUAGE_C
#undef MIPSEB
#undef MIPSEL
#undef PPC
#undef R3000
#undef R4000
#undef i386
#undef linux
#undef mips
#undef near
#undef far
#undef powerpc
#undef unix
#define nimfr_(x, y)
#define nimln_(x, y)
typedef struct tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag;
typedef struct tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g;
typedef struct RootObj RootObj;
typedef struct TNimTypeV2 TNimTypeV2;
typedef struct NimStrPayload NimStrPayload;
typedef struct NimStringV2 NimStringV2;
struct TNimTypeV2 {
void* destructor;
NI size;
NI align;
NCSTRING name;
void* traceImpl;
void* typeInfoV1;
NI flags;
};
struct RootObj {
TNimTypeV2* m_type;
};
struct NimStrPayload {
NI cap;
NIM_CHAR data[SEQ_DECL_SIZE];
};
struct NimStringV2 {
NI len;
NimStrPayload* p;
};
struct tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag {
  RootObj Sup;
NI bufpos;
NCSTRING buf;
NimStringV2 bufStorage;
NI bufLen;
tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g* stream;
NI lineNumber;
NI sentinel;
NI lineStart;
NI offsetBase;
};
N_LIB_PRIVATE N_NIMCALL(NimStringV2, mnewString)(NI len);
N_NIMCALL(NimStringV2, mnewString)(NI len);
N_LIB_PRIVATE N_NIMCALL(void, eqsink___system_3234)(NimStringV2* dest, NimStringV2 src);
static N_INLINE(NCSTRING, nimToCStringConv)(NimStringV2 s);
N_LIB_PRIVATE N_NIMCALL(void, eqcopy___astZllstream_70)(tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g** dest, tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g* src, NIM_BOOL cyclic);
N_LIB_PRIVATE N_NIMCALL(void, fillBuffer__astZnimlexbase_45)(tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag* L);
static N_INLINE(void, moveMem__system_1712)(void* dest, void* source, NI size);
N_LIB_PRIVATE N_NIMCALL(NI, llStreamRead__astZllstream_230)(tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g* s, void* buf, NI bufLen);
N_LIB_PRIVATE N_NIMCALL(void, setLengthStrV2)(NimStringV2* s, NI newLen);
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void);
N_LIB_PRIVATE N_NIMCALL(void, skipUTF8BOM__astZnimlexbase_108)(tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag* L);
N_LIB_PRIVATE N_NIMCALL(NI, fillBaseLexer__astZnimlexbase_75)(tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag* L, NI pos);
N_LIB_PRIVATE N_NIMCALL(void, llStreamClose__astZllstream_163)(tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g* s);
extern NIM_BOOL nimInErrorMode__system_4174;
static N_INLINE(NCSTRING, nimToCStringConv)(NimStringV2 s) {
	NCSTRING result;
	result = (NCSTRING)0;
	{
		{
			if (!(s.len == ((NI) 0))) goto LA4_;
			result = "";
			goto LA1;
		}
		LA4_: ;
		result = ((NCSTRING) ((*s.p).data));
	} LA1: ;
	return result;
}
static N_INLINE(void, moveMem__system_1712)(void* dest, void* source, NI size) {
	void* T1_;
	T1_ = (void*)0;
	T1_ = memmove(dest, source, ((size_t) (size)));
	(void)(T1_);
}
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void) {
	NIM_BOOL* result;
	result = (NIM_BOOL*)0;
	result = (&nimInErrorMode__system_4174);
	return result;
}
N_LIB_PRIVATE N_NIMCALL(void, fillBuffer__astZnimlexbase_45)(tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag* L) {
	NI charsRead;
	NI toCopy;
	NI s;
	NI oldBufLen;
	tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g* T6_;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	charsRead = (NI)0;
	toCopy = (NI)0;
	s = (NI)0;
	oldBufLen = (NI)0;
	toCopy = (NI)((NI)((*L).bufLen - (*L).sentinel) - ((NI) 1));
	{
		void* T5_;
		if (!(((NI) 0) < toCopy)) goto LA3_;
		T5_ = (void*)0;
		T5_ = ((void*) ((&(*L).buf[((NI) 0)])));
		moveMem__system_1712(T5_, ((void*) ((&(*L).buf[(NI)((*L).sentinel + ((NI) 1))]))), ((NI) (toCopy)));
		if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}
	LA3_: ;
	T6_ = (tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g*)0;
	T6_ = (*L).stream;
	charsRead = llStreamRead__astZllstream_230(T6_, ((void*) ((&(*L).buf[toCopy]))), (NI)((*L).sentinel + ((NI) 1)));
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	s = (NI)(toCopy + charsRead);
	{
		{
			if (!(charsRead < (NI)((*L).sentinel + ((NI) 1)))) goto LA10_;
			(*L).buf[s] = 0;
			(*L).sentinel = s;
			goto LA7;
		}
		LA10_: ;
		s -= ((NI) 1);
		{
			while (1) {
				{
					while (1) {
						NIM_BOOL colontmp_;
						colontmp_ = (NIM_BOOL)0;
						{
							colontmp_ = (((NI) 0) <= s);
							{
								if (!!(colontmp_)) goto LA19_;
								goto LA16;
							}
							LA19_: ;
							colontmp_ = !((((NU8)((*L).buf[s])) == ((NU8)(13)) || ((NU8)((*L).buf[s])) == ((NU8)(10))));
						} LA16: ;
						{
							if (!!(colontmp_)) goto LA23_;
							goto LA15;
						}
						LA23_: ;
						s -= ((NI) 1);
					} LA15: ;
				}
				{
					tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g* T30_;
					{
						if (!(((NI) 0) <= s)) goto LA28_;
						(*L).sentinel = s;
						goto LA12;
					}
					LA28_: ;
					oldBufLen = (*L).bufLen;
					(*L).bufLen = (NI)((*L).bufLen * ((NI) 2));
					setLengthStrV2((&(*L).bufStorage), ((NI) ((*L).bufLen)));
					(*L).buf = nimToCStringConv((*L).bufStorage);
					T30_ = (tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g*)0;
					T30_ = (*L).stream;
					charsRead = llStreamRead__astZllstream_230(T30_, ((void*) ((&(*L).buf[oldBufLen]))), oldBufLen);
					if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
					{
						if (!(charsRead < oldBufLen)) goto LA33_;
						(*L).buf[(NI)(oldBufLen + charsRead)] = 0;
						(*L).sentinel = (NI)(oldBufLen + charsRead);
						goto LA12;
					}
					LA33_: ;
					s = (NI)((*L).bufLen - ((NI) 1));
				}
			}
		} LA12: ;
	} LA7: ;
	}BeforeRet_: ;
}
N_LIB_PRIVATE N_NIMCALL(void, skipUTF8BOM__astZnimlexbase_108)(tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag* L) {
	NIM_BOOL colontmp_;
	NIM_BOOL colontmp__2;
	colontmp_ = (NIM_BOOL)0;
	colontmp__2 = (NIM_BOOL)0;
	{
		{
			colontmp_ = ((NU8)((*L).buf[((NI) 0)]) == (NU8)(239));
			{
				if (!!(colontmp_)) goto LA5_;
				goto LA2;
			}
			LA5_: ;
			colontmp_ = ((NU8)((*L).buf[((NI) 1)]) == (NU8)(187));
		} LA2: ;
		colontmp__2 = colontmp_;
		{
			if (!!(colontmp__2)) goto LA9_;
			goto LA1;
		}
		LA9_: ;
		colontmp__2 = ((NU8)((*L).buf[((NI) 2)]) == (NU8)(191));
	} LA1: ;
	{
		if (!colontmp__2) goto LA13_;
		(*L).bufpos += ((NI) 3);
		(*L).lineStart += ((NI) 3);
	}
	LA13_: ;
}
N_LIB_PRIVATE N_NIMCALL(void, openBaseLexer__astZnimlexbase_25)(tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag* L, tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g* inputstream, NI bufLen) {
	NimStringV2* colontmp_;
	NimStringV2 colontmp__2;
	tyObject_TLLStream__a5oZYQ9aTktYME2449ayEi6g** colontmp__3;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	(*L).bufpos = ((NI) 0);
	(*L).offsetBase = ((NI) 0);
	colontmp_ = (&(*L).bufStorage);
	colontmp__2 = mnewString(((NI) (bufLen)));
	eqsink___system_3234(colontmp_, colontmp__2);
	(*L).buf = nimToCStringConv((*L).bufStorage);
	(*L).bufLen = bufLen;
	(*L).sentinel = (NI)(bufLen - ((NI) 1));
	(*L).lineStart = ((NI) 0);
	(*L).lineNumber = ((NI) 1);
	colontmp__3 = &(*L).stream;
	eqcopy___astZllstream_70(colontmp__3, inputstream, NIM_TRUE);
	fillBuffer__astZnimlexbase_45(L);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	skipUTF8BOM__astZnimlexbase_108(L);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
}
N_LIB_PRIVATE N_NIMCALL(NI, getColNumber__astZnimlexbase_34)(tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag* L, NI pos) {
	NI result;
	result = (NI)0;
	result = ((NI)(pos - (*L).lineStart) > 0? ((NI)(pos - (*L).lineStart)) : -((NI)(pos - (*L).lineStart)));
	return result;
}
N_LIB_PRIVATE N_NIMCALL(NI, fillBaseLexer__astZnimlexbase_75)(tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag* L, NI pos) {
	NI result;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result = (NI)0;
	{
		{
			if (!(pos < (*L).sentinel)) goto LA4_;
			result = (NI)(pos + ((NI) 1));
			goto LA1;
		}
		LA4_: ;
		fillBuffer__astZnimlexbase_45(L);
		if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
		(*L).offsetBase += (NI)(pos + ((NI) 1));
		(*L).bufpos = ((NI) 0);
		result = ((NI) 0);
	} LA1: ;
	(*L).lineStart = result;
	}BeforeRet_: ;
	return result;
}
N_LIB_PRIVATE N_NIMCALL(NI, handleCR__astZnimlexbase_37)(tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag* L, NI pos) {
	NI result;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result = (NI)0;
	(*L).lineNumber += ((NI) 1);
	result = fillBaseLexer__astZnimlexbase_75(L, pos);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	{
		if (!((NU8)((*L).buf[result]) == (NU8)(10))) goto LA3_;
		result = fillBaseLexer__astZnimlexbase_75(L, result);
		if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}
	LA3_: ;
	}BeforeRet_: ;
	return result;
}
N_LIB_PRIVATE N_NIMCALL(NI, handleLF__astZnimlexbase_40)(tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag* L, NI pos) {
	NI result;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result = (NI)0;
	(*L).lineNumber += ((NI) 1);
	result = fillBaseLexer__astZnimlexbase_75(L, pos);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
	return result;
}
N_LIB_PRIVATE N_NIMCALL(void, closeBaseLexer__astZnimlexbase_29)(tyObject_TBaseLexer__jTxk7Uc2dfr9aTDL2dZhO9ag* L) {
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	llStreamClose__astZllstream_163((*L).stream);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
}
